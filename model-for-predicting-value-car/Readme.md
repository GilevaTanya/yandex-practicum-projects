# Модель для прогнозирования рыночной стоимости автомобиля

## **Стек:**
Python, Pandas, seaborn, matplotlib, scikit-learn, lightgbm.

## **Описание:**  
Сервис по продаже автомобилей с пробегом «Не бит, не крашен» разрабатывает приложение для привлечения новых клиентов. В нём можно быстро узнать рыночную стоимость своего автомобиля. В вашем распоряжении исторические данные: технические характеристики, комплектации и цены автомобилей. Вам нужно построить модель для определения стоимости.

**Задача:** Разработать модель для прогнозирования рыночной стоимости автомобиля  

**Основные требования заказчика:**  
 * качество предсказания по RMSE должно быть меньше 2500;  
 * скорость предсказания;  
 * время обучения.  
 
## **План действий:**  
 1. Загрузить данные.
 2. Изучить данные. Обработать пропущенные значения и аномалии, неинформативные признаки - удалить.
 3. Подготовить выборки для обучения моделей.
 4. Обучим разные модели, одна из которых — LightGBM и как минимум одна — не бустинг. Попробуем разные гиперпараметры.
 5. Проанализируем время обучения, время предсказания и качество моделей.
 6. Опираясь на критерии заказчика, выберете лучшую модель, проверьте её качество на тестовой выборке.


**Признаки:**  
*DateCrawled* — дата скачивания анкеты из базы  
*VehicleType* — тип автомобильного кузова  
*RegistrationYear* — год регистрации автомобиля  
*Gearbox* — тип коробки передач  
*Power* — мощность (л. с.)  
*Model* — модель автомобиля  
*Kilometer* — пробег (км)  
*RegistrationMonth* — месяц регистрации автомобиля  
*FuelType* — тип топлива  
*Brand* — марка автомобиля  
*Repaired* — была машина в ремонте или нет  
*DateCreated* — дата создания анкеты  
*NumberOfPictures* — количество фотографий автомобиля  
*PostalCode* — почтовый индекс владельца анкеты (пользователя)  
*LastSeen* — дата последней активности пользователя  
  
**Целевой признак**  
*Price* — цена (евро)

## **ИТОГОВЫЙ ВЫВОД ИССЛЕДОВАНИЯ:**  

Изначальный датасет содержал 354 369 строк и 16 столбцов, типы данных по столбцам присвоены корректно. 
На этапе предобработки были удалены строки с нулевым целевым признаком по столбцу Price и строки по столбцу RegistrationYear с датой регистрации автомобиля за пределами периода с 1946 по 2016 года.  
Пропуски и аномалии были обработаны в следущем формате:
- В VehicleType, пропуски были заменены по типу кузова такой же модели, если сопоставление сделать было невозможно, производилась замена на  'other'.
- В Gearbox, пропуски были заменены на 'other' т.к. в датасете присутствовало только два вида коробки передач.
- В Model, пропуски были заменены на 'other', т.к. Сопоставить модели по другим признаком не представлеяется возможным. Синонимы  'range_rover' и 'rangerover' были объединены под маркой 'range_rover'. 
- В FuelType, пропуски были скорректированы по типу топлива такой же модели. Так как названия топлива 'petrol' и 'gasoline' это одно и тоже, были объеденены под типом 'gasoline'.
- В Repaired, пропуски были заменены на “unknown”, т.к. подтвердить факт ремонта нет возможности.   
- В Power присутствовали строки с “0” мощностью, была произведена корректировка в соответствии с аналогичной мощностью по такой же Модели или Бренду.
- RegistrationMonth - строки с “0” заменены на “unknown”.
- В Brand  синонимы 'land_rover' и 'rover' были объединены под брендом 'land_rover'.
- Kilometer - большинство моделей с пробегом более 125 тыс.км.
- DateCreated — большинство анкет которые включены в датасет были созданы в 2016г.
- LastSeen -  Все анкеты датасета были активированы в течении месяца выгрузки данных в 2016г.
  
По итогу поведенных преобразований сохранен изначальный датасет в объеме - 92,7%. 

Для ускорения работы модели, были удалены столбцы с признаками которые не влияют прогнозирование целевого признака:
- DateCrawled 
- RegistrationMonth 
- DateCreated 
- NumberOfPictures 
- PostalCode 
- LastSeen  

При подготовке данных к обучению, к датасету было применено прямое кодирование с целью преобразования категориальных признаков в численные посредством OHE, а также произведено масштабирование признаков. Для модели LightGBM кодировка через OHE не проводилась.

Датафрейм был разделен на тренировочную, валидационную и тестовые выборки из пропорции 60%/20%/20%.  

Основными требования заказчика к модели предсказания рыночной стоимости автомобиля, являются:
 - качество предсказания (RMSE должно быть менее 2500);
 - скорость предсказания (фиксация через команду `%%time`);
 - время обучения (фиксация через команду `%%time`).

Исходя из этих требований было обучено и протестировано 3 моделей: Линейная регрессия, Дерево Решений и бустинг LightGBM.
По итогам проведенного исследования на валидационной выборке:
- наилучший результат по целевой метрике RMSE получен по LightGBM - 1617,53, при этом время потраченное на обучение - 13.3s  и предсказание - 1.28s, это средний совокупный показатель.
- вторим по качеству предсказаний было Дерево Решений: RMSE - 1881.47, время потраченное на обучение - 4.65 s  и предсказание  - 126 ms  - самый быстрый показатель.
- самый низкий результат по целевой метрике оказалась Линейная Регрессия: RMSE - 2840.57, время потраченное на обучение - 16.4s и предсказание - 196 ms  - самый медленный совокупный показатель.

**Исходя из совокупности обозначенных заказчиком требований я бы предложила остановиться на модели LightGBM, т.к данный алгоритм выдает самую низкую ошибку на валидаци - 1617,53, при этом скорость предсказания 1,28s  для будущего пользователя приложения сервиса «Не бит, не крашен» достаточно приемлемая.**  

**По итогу проверки `LightGBM на тестовой выборке, получаем RMSE -  1611.62, время предсказания 1,19 s.`  
Относительно валидации качество немного повысилось, модель работает на новых данных корректно.**


