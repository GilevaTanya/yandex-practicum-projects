# Модель определение возраста покупателей по фотографии

## **Стек:**
Python, Pandas, Keras, PIL , matplotlib.  

## **Описание:**  
Сетевой супермаркет внедряет систему компьютерного зрения для обработки фотографий покупателей. 
Фотофиксация в прикассовой зоне поможет определять возраст клиентов, чтобы:
- анализировать покупки и предлагать товары, которые могут заинтересовать покупателей этой возрастной группы;
- контролировать добросовестность кассиров при продаже алкоголя.

**Целевая метрика:** MAE на тестовой выборке меньше 8.

## **План по выполнению проекта:**  
- Провести исследовательский анализ набора фотографий.
- Подготовьте данные к обучению.
- Обучите нейронную сеть и рассчитайте её качество.

**Описание данных:**  
Данные взяты с сайта ChaLearn Looking at People. 
В папке `/datasets/faces/` находится: 
- папка со всеми изображениями `/final_files` и 
- CSV-файл `labels.csv` с двумя колонками: file_name и real_age.

## **Выводы:**
Для разработки модели которая по фотографии будет определять приблизительный возраст человека, был предоставлен датасет с сайта `ChaLearn Looking at People`,  папка `/datasets/faces/`.
В нем представлено 7591 фото людей разных возрастов от 1 года, до 100 лет. 

Для разработки модели которая в качестве признаков принимает фото, наилучшим образом подходят нейронные сети.
Цель модели определить возраст человека, т.к. количественную величину, поэтому будем решать ее по средствам регрессии.
Однако, т.к. возраст людей варьируется от 1 до 100, то классификация с 99 классами также могла бы работать.

Представленного количества фото должно быть достаточно для до обучения нейронной сети, ранее обученной на аналогичных данных. Типы данных были указанные верно, пропуски отсутствовали.
 
- В датафрейме 2 столбца:  
`file_name` прописаны названия фото  
`real_age` реальный возраст людей на фото - целевой признак.  
 
Распределение данных по возрасту стремится к нормальному, с рядом выбросов: районе первых 1 года, 25 лет, 30 лет, 40 лет и 50 лет. Медиана находится на уровне 29 лет, средняя на уровне 31 года, показатели достаточно близки что говорит о том что выбросы не оказывают большого влияния на данные, исходя из исторических данных в разных странах такое распределение вполне может иметь место быть.  

В выборке есть редкие классы, люди в возрасте 3 лет, от 8 до 15 лет и люди в возрасте после 52 лет(за исключением 60-летних). В связи с этим сеть скорее всего будет чаще ошибаться именно в эти классах, что негативно скажется на качестве всей модели. Думаю наилучшим вариантом будет увеличение редких классов минимум до 70 объектов посредствам аугментации. Также если смотреть по выгруженным фото размерность у всех разная, при загрузке в модель нужно сделать все размерности одинаковыми: 224х224 будет достаточно.

**Параметры модели:**  

- Загрузка данных обучающей выборки и теста через `ImageDataGenerator`:
  - произведена нормировка, 
  - добавлены повороты по горизонтали (только для обучающей выборке), для того чтобы увеличить количество редких классов.
  - все фото приведены к размерности 224х224
  - определен размер батча - 32
  - сlass_mode определен как "raw": числовой массив значений в y_col столбцах.

- При создании нейронной сети была использована архитектура архитектура `ResNet50` в качестве бэкбона, заморозка весов бэкбона не использовалась. Веса загружены с сервера по пути `/datasets/keras_models/resnet50_weights_tf_dim_ordering_tf_kernels_notop.h5` в функции создания модели. Параметр include_top установлен в False, это значит что веса только для бэкбона, а не для полносвязного слоя верхушки.

- Верхушка реализована через 2 полносвязных слоя, в 112 нейронов и 1 нейрон соответственно, активация `relu`.

- Оптимизатор: Adam с learning rate = 0.0001

- Количество эпох: 5

- Достигнутое по итогу 5 эпохи качество: **при обучении mae: 3.78, при валидации val_mae: 6,48. Целевой показатель достигнут.**

Можно считать что модель не успела переобучиться за 5 эпох, ведь с каждой новой эпохой качество на валидации только повышалось и по результатам 5 эпохи видно, что на тесте модель показала лучше качество MAE чем на трейне той же эпохи.

Думаю если глубже проработать датасет и довести количество фото по каждому возрасту до 200 фото, можно добиться еще более высоко качества предсказания.

